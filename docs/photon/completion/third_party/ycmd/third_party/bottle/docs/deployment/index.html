
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Deployment &#8212; PHOTON platform&lt;br/&gt;•&lt;br/&gt;.vim  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/photonsphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/graphviz.css" />
    <script data-url_root="../../../../../../../../" id="documentation_options" src="../../../../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../../../../_static/jquery.js"></script>
    <script src="../../../../../../../../_static/underscore.js"></script>
    <script src="../../../../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../../../../../_static/doctools.js"></script>
    <script src="../../../../../../../../_static/sphinx_highlight.js"></script>
    <link rel="canonical" href="https://photon-platform.github.io/vim/photon/completion/third_party/ycmd/third_party/bottle/docs/deployment.html" />
    <link rel="index" title="Index" href="../../../../../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../../../../../search/" /> 
   
  <link rel="stylesheet" href="../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../../../../../../log/atom.xml"
  title="PHOTON platform • .vim"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
             <section id="deployment">
<span id="tutorial-deployment"></span><h1>Deployment<a class="headerlink" href="#deployment" title="Permalink to this heading">¶</a></h1>
<p>The bottle <code class="xref py py-func docutils literal notranslate"><span class="pre">run()</span></code> function, when called without any parameters, starts a local development server on port 8080. You can access and test your application via <a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a> if you are on the same host.</p>
<p>To get your application available to the outside world, specify the IP of the interface the server should listen to (e.g. <code class="docutils literal notranslate"><span class="pre">run(host='192.168.0.1')</span></code>) or let the server listen to all interfaces at once (e.g. <code class="docutils literal notranslate"><span class="pre">run(host='0.0.0.0')</span></code>). The listening port can be changed in a similar way, but you need root or admin rights to choose a port below 1024. Port 80 is the standard for HTTP servers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span> <span class="c1"># Listen to HTTP requests on all interfaces</span>
</pre></div>
</div>
<section id="server-options">
<h2>Server Options<a class="headerlink" href="#server-options" title="Permalink to this heading">¶</a></h2>
<p>The built-in default server is based on <a class="reference external" href="http://docs.python.org/library/wsgiref.html#module-wsgiref.simple_server">wsgiref WSGIServer</a>. This non-threading HTTP server is perfectly fine for development and early production, but may become a performance bottleneck when server load increases. There are three ways to eliminate this bottleneck:</p>
<ul class="simple">
<li><p>Use a different server that is either multi-threaded or asynchronous.</p></li>
<li><p>Start multiple server processes and spread the load with a load-balancer.</p></li>
<li><p>Do both.</p></li>
</ul>
<p><strong>Multi-threaded</strong> servers are the ‘classic’ way to do it. They are very robust, reasonably fast and easy to manage. As a drawback, they can only handle a limited number of connections at the same time and utilize only one CPU core due to the “Global Interpreter Lock” (GIL). This does not hurt most applications, they are waiting for network IO most of the time anyway, but may slow down CPU intensive tasks (e.g. image processing).</p>
<p><strong>Asynchronous</strong> servers are very fast, can handle a virtually unlimited number of concurrent connections and are easy to manage, but can get a bit tricky. To take full advantage of their potential, you need to design your application accordingly and understand the concepts of the specific server.</p>
<p><strong>Multi-processing</strong> (forking) servers are not limited by the GIL and utilize more than one CPU core, but make communication between server instances more expensive. You need a database or external message query to share state between processes, or design your application so that it does not need any shared state. The setup is also a bit more complicated, but there are good tutorials available.</p>
</section>
<section id="switching-the-server-backend">
<h2>Switching the Server Backend<a class="headerlink" href="#switching-the-server-backend" title="Permalink to this heading">¶</a></h2>
<p>The easiest way to increase performance is to install a multi-threaded server library like <a class="reference external" href="http://pythonpaste.org/">paste</a> or <a class="reference external" href="http://www.cherrypy.org/">cherrypy</a> and tell Bottle to use that instead of the single-threaded server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bottle</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s1">&#39;paste&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Bottle ships with a lot of ready-to-use adapters for the most common WSGI servers and automates the setup process. Here is an incomplete list:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Homepage</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cgi</p></td>
<td></td>
<td><p>Run as CGI script</p></td>
</tr>
<tr class="row-odd"><td><p>flup</p></td>
<td><p><a class="reference external" href="http://trac.saddi.com/flup">flup</a></p></td>
<td><p>Run as FastCGI process</p></td>
</tr>
<tr class="row-even"><td><p>gae</p></td>
<td><p><a class="reference external" href="http://code.google.com/appengine/docs/python/overview.html">gae</a></p></td>
<td><p>Helper for Google App Engine deployments</p></td>
</tr>
<tr class="row-odd"><td><p>wsgiref</p></td>
<td><p><a class="reference external" href="http://docs.python.org/library/wsgiref.html">wsgiref</a></p></td>
<td><p>Single-threaded default server</p></td>
</tr>
<tr class="row-even"><td><p>cherrypy</p></td>
<td><p><a class="reference external" href="http://www.cherrypy.org/">cherrypy</a></p></td>
<td><p>Multi-threaded and very stable</p></td>
</tr>
<tr class="row-odd"><td><p>paste</p></td>
<td><p><a class="reference external" href="http://pythonpaste.org/">paste</a></p></td>
<td><p>Multi-threaded, stable, tried and tested</p></td>
</tr>
<tr class="row-even"><td><p>rocket</p></td>
<td><p><a class="reference external" href="http://pypi.python.org/pypi/rocket">rocket</a></p></td>
<td><p>Multi-threaded</p></td>
</tr>
<tr class="row-odd"><td><p>waitress</p></td>
<td><p><a class="reference external" href="http://readthedocs.org/docs/waitress/en/latest/">waitress</a></p></td>
<td><p>Multi-threaded, poweres Pyramid</p></td>
</tr>
<tr class="row-even"><td><p>gunicorn</p></td>
<td><p><a class="reference external" href="http://pypi.python.org/pypi/gunicorn">gunicorn</a></p></td>
<td><p>Pre-forked, partly written in C</p></td>
</tr>
<tr class="row-odd"><td><p>eventlet</p></td>
<td><p><a class="reference external" href="http://eventlet.net/">eventlet</a></p></td>
<td><p>Asynchronous framework with WSGI support.</p></td>
</tr>
<tr class="row-even"><td><p>gevent</p></td>
<td><p><a class="reference external" href="http://www.gevent.org/">gevent</a></p></td>
<td><p>Asynchronous (greenlets)</p></td>
</tr>
<tr class="row-odd"><td><p>diesel</p></td>
<td><p><a class="reference external" href="http://dieselweb.org/">diesel</a></p></td>
<td><p>Asynchronous (greenlets)</p></td>
</tr>
<tr class="row-even"><td><p>fapws3</p></td>
<td><p><a class="reference external" href="http://www.fapws.org/">fapws3</a></p></td>
<td><p>Asynchronous (network side only), written in C</p></td>
</tr>
<tr class="row-odd"><td><p>tornado</p></td>
<td><p><a class="reference external" href="http://www.tornadoweb.org/">tornado</a></p></td>
<td><p>Asynchronous, powers some parts of Facebook</p></td>
</tr>
<tr class="row-even"><td><p>twisted</p></td>
<td><p><a class="reference external" href="http://twistedmatrix.com/">twisted</a></p></td>
<td><p>Asynchronous, well tested but… twisted</p></td>
</tr>
<tr class="row-odd"><td><p>meinheld</p></td>
<td><p><a class="reference external" href="http://pypi.python.org/pypi/meinheld">meinheld</a></p></td>
<td><p>Asynchronous, partly written in C</p></td>
</tr>
<tr class="row-even"><td><p>bjoern</p></td>
<td><p><a class="reference external" href="http://pypi.python.org/pypi/bjoern">bjoern</a></p></td>
<td><p>Asynchronous, very fast and written in C</p></td>
</tr>
<tr class="row-odd"><td><p>auto</p></td>
<td></td>
<td><p>Automatically selects an available server adapter</p></td>
</tr>
</tbody>
</table>
<p>The full list is available through <code class="xref py py-data docutils literal notranslate"><span class="pre">server_names</span></code>.</p>
<p>If there is no adapter for your favorite server or if you need more control over the server setup, you may want to start the server manually. Refer to the server documentation on how to run WSGI applications. Here is an example for <a class="reference external" href="http://pythonpaste.org/">paste</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">bottle</span><span class="o">.</span><span class="n">default_app</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">paste</span> <span class="kn">import</span> <span class="n">httpserver</span>
<span class="n">httpserver</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<section id="apache-mod-wsgi">
<h3>Apache mod_wsgi<a class="headerlink" href="#apache-mod-wsgi" title="Permalink to this heading">¶</a></h3>
<p>Instead of running your own HTTP server from within Bottle, you can attach Bottle applications to an <a class="reference external" href="apache">Apache server</a> using <a class="reference external" href="http://code.google.com/p/modwsgi/">mod_wsgi</a>.</p>
<p>All you need is an <code class="docutils literal notranslate"><span class="pre">app.wsgi</span></code> file that provides an <code class="docutils literal notranslate"><span class="pre">application</span></code> object. This object is used by mod_wsgi to start your application and should be a WSGI-compatible Python callable.</p>
<p>File <code class="docutils literal notranslate"><span class="pre">/var/www/yourapp/app.wsgi</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change working directory so relative paths (and template lookup) work again</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">bottle</span>
<span class="c1"># ... build or import your bottle application here ...</span>
<span class="c1"># Do NOT use bottle.run() with mod_wsgi</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">bottle</span><span class="o">.</span><span class="n">default_app</span><span class="p">()</span>
</pre></div>
</div>
<p>The Apache configuration may look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">VirtualHost</span> <span class="o">*&gt;</span>
    <span class="n">ServerName</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>

    <span class="n">WSGIDaemonProcess</span> <span class="n">yourapp</span> <span class="n">user</span><span class="o">=</span><span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="n">group</span><span class="o">=</span><span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="n">processes</span><span class="o">=</span><span class="mi">1</span> <span class="n">threads</span><span class="o">=</span><span class="mi">5</span>
    <span class="n">WSGIScriptAlias</span> <span class="o">/</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">yourapp</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi</span>

    <span class="o">&lt;</span><span class="n">Directory</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">yourapp</span><span class="o">&gt;</span>
        <span class="n">WSGIProcessGroup</span> <span class="n">yourapp</span>
        <span class="n">WSGIApplicationGroup</span> <span class="o">%</span><span class="p">{</span><span class="n">GLOBAL</span><span class="p">}</span>
        <span class="n">Order</span> <span class="n">deny</span><span class="p">,</span><span class="n">allow</span>
        <span class="n">Allow</span> <span class="kn">from</span> <span class="nn">all</span>
    <span class="o">&lt;/</span><span class="n">Directory</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">VirtualHost</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="google-appengine">
<h3>Google AppEngine<a class="headerlink" href="#google-appengine" title="Permalink to this heading">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">gae</span></code> server adapter is used to run applications on Google App Engine. It works similar to the <code class="docutils literal notranslate"><span class="pre">cgi</span></code> adapter in that it does not start a new HTTP server, but prepares and optimizes your application for Google App Engine and makes sure it conforms to their API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bottle</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s1">&#39;gae&#39;</span><span class="p">)</span> <span class="c1"># No need for a host or port setting.</span>
</pre></div>
</div>
<p>It is always a good idea to let GAE serve static files directly. Here is example for a working  <code class="docutils literal notranslate"><span class="pre">app.yaml</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">application</span><span class="p">:</span> <span class="n">myapp</span>
<span class="n">version</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">runtime</span><span class="p">:</span> <span class="n">python</span>
<span class="n">api_version</span><span class="p">:</span> <span class="mi">1</span>

<span class="n">handlers</span><span class="p">:</span>
<span class="o">-</span> <span class="n">url</span><span class="p">:</span> <span class="o">/</span><span class="n">static</span>
  <span class="n">static_dir</span><span class="p">:</span> <span class="n">static</span>

<span class="o">-</span> <span class="n">url</span><span class="p">:</span> <span class="o">/.*</span>
  <span class="n">script</span><span class="p">:</span> <span class="n">myapp</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</section>
<section id="load-balancer-manual-setup">
<h3>Load Balancer (Manual Setup)<a class="headerlink" href="#load-balancer-manual-setup" title="Permalink to this heading">¶</a></h3>
<p>A single Python process can utilize only one CPU at a time, even if there are more CPU cores available. The trick is to balance the load between multiple independent Python processes to utilize all of your CPU cores.</p>
<p>Instead of a single Bottle application server, you start one instance for each CPU core available using different local port (localhost:8080, 8081, 8082, …). You can choose any server adapter you want, even asynchronous ones. Then a high performance load balancer acts as a reverse proxy and forwards each new requests to a random port, spreading the load between all available back-ends. This way you can use all of your CPU cores and even spread out the load between different physical servers.</p>
<p>One of the fastest load balancers available is <a class="reference external" href="http://www.apsis.ch/pound">Pound</a> but most common web servers have a proxy-module that can do the work just fine.</p>
<p>Pound example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ListenHTTP</span>
    <span class="n">Address</span> <span class="mf">0.0.0.0</span>
    <span class="n">Port</span>    <span class="mi">80</span>

    <span class="n">Service</span>
        <span class="n">BackEnd</span>
            <span class="n">Address</span> <span class="mf">127.0.0.1</span>
            <span class="n">Port</span>    <span class="mi">8080</span>
        <span class="n">End</span>
        <span class="n">BackEnd</span>
            <span class="n">Address</span> <span class="mf">127.0.0.1</span>
            <span class="n">Port</span>    <span class="mi">8081</span>
        <span class="n">End</span>
    <span class="n">End</span>
<span class="n">End</span>
</pre></div>
</div>
<p>Apache example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Proxy</span> <span class="n">balancer</span><span class="p">:</span><span class="o">//</span><span class="n">mycluster</span><span class="o">&gt;</span>
<span class="n">BalancerMember</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.1.50</span><span class="p">:</span><span class="mi">80</span>
<span class="n">BalancerMember</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.1.51</span><span class="p">:</span><span class="mi">80</span>
<span class="o">&lt;/</span><span class="n">Proxy</span><span class="o">&gt;</span>
<span class="n">ProxyPass</span> <span class="o">/</span> <span class="n">balancer</span><span class="p">:</span><span class="o">//</span><span class="n">mycluster</span>
</pre></div>
</div>
<p>Lighttpd example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">server</span><span class="o">.</span><span class="n">modules</span> <span class="o">+=</span> <span class="p">(</span> <span class="s2">&quot;mod_proxy&quot;</span> <span class="p">)</span>
<span class="n">proxy</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="p">(</span>
        <span class="s2">&quot;wsgi1&quot;</span> <span class="o">=&gt;</span> <span class="p">(</span> <span class="s2">&quot;host&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span> <span class="o">=&gt;</span> <span class="mi">8080</span> <span class="p">),</span>
        <span class="s2">&quot;wsgi2&quot;</span> <span class="o">=&gt;</span> <span class="p">(</span> <span class="s2">&quot;host&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span> <span class="o">=&gt;</span> <span class="mi">8081</span> <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="good-old-cgi">
<h2>Good old CGI<a class="headerlink" href="#good-old-cgi" title="Permalink to this heading">¶</a></h2>
<p>A CGI server starts a new process for each request. This adds a lot of overhead but is sometimes the only option, especially on cheap hosting packages. The <cite>cgi</cite> server adapter does not actually start a CGI server, but transforms your bottle application into a valid CGI application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bottle</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s1">&#39;cgi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>

<div class="section">
   
</div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../../../../../../">
    <img class="logo" src="../../../../../../../../_static/logo.png" alt="Logo"/>
    
    <h1 class="logo logo-name">PHOTON platform<br/>•<br/>.vim</h1>
    
  </a>
</p>





<iframe src="https://ghbtns.com/github-btn.html?user=photon-platform&type=follow&count=true&size=large" frameborder="0" scrolling="0" width="230" height="30" title="GitHub"></iframe>


<p>
<iframe src="https://ghbtns.com/github-btn.html?user=photon-platform&repo=vim&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




<!-- <h3>Navigation</h3> -->


<h3>
  <a href="../../../../../../../../log/">LOG recent</a>
</h3>
<ul>
   
  <li>
    <a href="../../../../../../../../log/22.348-113439/"
      >22.348 - Welcome to the .vim project</a
    >
  </li>
  
</ul>

<h3>
  <a href="../../../../../../../../log/category/">Categories</a>
</h3>
<ul>
   
  <li>
    <a href="../../../../../../../../log/category/status/">STATUS (1)</a>
  </li>
   
</ul>

<h3>
  <a href="../../../../../../../../log/archive/">Archives</a>
</h3>
<ul>
   
  <li>
    <a href="../../../../../../../../log/2022/">2022 (1)</a>
  </li>
   
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, PHOTON platform.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/photon-platform/photon-sphinx-theme">PHOTON Sphinx 0.0.1</a>
      
      |
      <a href="../../../../../../../../_sources/photon/completion/third_party/ycmd/third_party/bottle/docs/deployment.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>